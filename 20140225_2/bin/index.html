<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8"/>
	<title>HTC</title>
	<meta name="description" content="" />
	<script src="js/lib/jquery/jquery-1.9.min.js"></script>
	<script src="js/lib/underscore/underscore.js"></script>
	<script src="js/lib/backbone/backbone.js"></script>
	<script src="js/lib/vic/vic.facebook.js"></script>
	<script src="js/swfobject.js"></script>
	<script>
	(function(d, s, id) {
		//local test
		var appid = '1059025554112783'
		
		//real test
		//var appid = '772221816202407'
		var js, fjs = d.getElementsByTagName(s)[0];
		if (d.getElementById(id)) return;
		js = d.createElement(s); js.id = id;
		js.src = "//connect.facebook.net/zh_TW/sdk.js#xfbml=1&appId="+appid+"&version=v2.0";
		fjs.parentNode.insertBefore(js, fjs);
	}(document, 'script', 'facebook-jssdk'));
	</script>
	<script>
		var flashvars = {
		};
		var params = {
			menu: "false",
			scale: "noScale",
			allowFullscreen: "true",
			allowScriptAccess: "always",
			bgcolor: "",
			wmode: "direct" // can cause issues with FP settings & webcam
		};
		var attributes = {
			id:"HTC"
		};
		swfobject.embedSWF(
			"HTC.swf?v=" + Math.random(), 
			"altContent", "100%", "100%", "10.0.0", 
			"expressInstall.swf", 
			flashvars, params, attributes);
	</script>
	<style>
		html, body { height:100%; overflow:hidden; }
		body { margin:0; }
	</style>
</head>
<body>
	
	<script>
	
					
	var Router = Backbone.Router.extend({
		routes:{
			'':'index',
			index:'index',
			TechPage:'TechPage',
			TechBlink:'TechBlink',
			TechBoom:'TechBoom',
			TechCamera: 'TechCamera',
			TechDouble: 'TechDouble',
			TechDolby: 'TechDolby',
			TechFrame: 'TechFrame',
			TechPerson: 'TechPerson',
			TechPhoto: 'TechPhoto',
			TechSitu: 'TechSitu',
			TechUltra: 'TechUltra'
		},
		index:function(){
			callFlashMethod( 'router', 'index' );
		},
		TechPage:function(){
			callFlashMethod( 'router', 'TechPage' );
		},
		TechBlink: function(){
			callFlashMethod( 'router', 'TechBlink' );
		},
		TechBoom: function(){
			callFlashMethod( 'router', 'TechBoom' );
		},
		TechCamera: function(){
			callFlashMethod( 'router', 'TechCamera' );
		},
		TechDouble: function(){
			callFlashMethod( 'router', 'TechDouble' );
		},
		TechDolby: function(){
			callFlashMethod( 'router', 'TechDolby' );
		},
		TechFrame: function(){
			callFlashMethod( 'router', 'TechFrame' );
		},
		TechPerson: function(){
			callFlashMethod( 'router', 'TechPerson' );
		},
		TechPhoto: function(){
			callFlashMethod( 'router', 'TechPhoto' );
		},
		TechSitu: function(){
			callFlashMethod( 'router', 'TechSitu' );
		},
		TechUltra: function(){
			callFlashMethod( 'router', 'TechUltra' );
		}
	})
	
	var router = new Router();
	window.__router = router;
	
	function flashReady(){
		console.log( 'flashReady' );
		Backbone.history.start();
	}
	
	function thisMovie(movieName) 
	{
		if (navigator.appName.indexOf("Microsoft") != -1) 
		{
			return window[movieName];
		} 
		else 
		{
			return document[movieName];
		}
	}
	
	function callFlashMethod( methodName, val )
	{
		//thisMovie("HTC").jsCallFlash( 'jshaha' );
		console.log( thisMovie("HTC") );
		console.log( thisMovie("HTC")[ methodName ] );
		thisMovie("HTC")[ methodName ]( val );
	}
	
	function flashCallJs( val ){
		console.log( 'from flash: ' + val );
		callFlashMethod();
	}
	</script>
	
	<!-- bridge -->
	
	<script>
	var externalObject = {}
	
	externalObject.changeHash = function( hash, cb ){
		window.__router.navigate( hash, { trigger: false } )
		cb( null, null );
	}
	
	externalObject.getMe = function( cb ){
		console.log('getMe');
		vic.facebook.getMyData(
			function( res ){
				console.log(res);
				cb( null, res );
			},
			function( err ){
				cb( err, null );
			}
		);
	}
	
	externalObject.loginFB = function( cb ){
		console.log('loginFB');
		vic.facebook.login( function( res ){
			console.log(res)
			cb(null, res );
		}, function( error ){
			cb(error, false );
		}, {scope: 'email'});
		
	}
	
	externalObject.shareFB = function( cb ){
		console.log('shareFB');
		vic.facebook.postMessageToMyboard( {
			name: 'name',
			link: 'http://rsclient.etmgup.com/htchima/',
			picture: '',
			caption: 'caption',
			description: 'description',
			callback:function(){
				cb( null, true );
			},
			error:function( error ){
				cb(error, false);
			}
		});
	}
	
	externalObject.isFBLogin = function( cb ){
		console.log('isFBLogin');
		vic.facebook.getLoginStatus( function( val ){
			console.log( val );
			cb(null, val);
		});
	}
	
	</script>
	
	<!-- basic -->
	<script>
	
	function genCallback( id ){
		return function(){
			thisMovie("HTC")[ 'callFromHtml' ]( {id: id, params:arguments } );
		}
	}
	
	function callFromFlash( val ){
		var id = val.id
		var method = val.method
		var params = val.params
		var callback = genCallback( id )
		params.push(callback)
		externalObject[method].apply( null, params );
	}
	
	</script>
	
	<div id="altContent">
		<h1>HTC</h1>
		<p><a href="http://www.adobe.com/go/getflashplayer">Get Adobe Flash player</a></p>
	</div>
</body>
</html>